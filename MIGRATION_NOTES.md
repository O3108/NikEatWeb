# Миграция функции getGlucose на сервер

## Выполненные изменения

### 1. Создан новый серверный API endpoint
**Файл:** `/src/app/api/glucose/calculate/route.ts`

Новый endpoint `POST /api/glucose/calculate` выполняет:
- Расчет средних значений глюкозы для дня и ночи
- Получение данных из LibreView API
- Обновление данных в базе данных
- Возврат обновленных данных клиенту

### 2. Обновлен StoreProvider
**Файл:** `/src/app/Providers/StoreProvider.tsx`

Изменения:
- Удален импорт `getGlucose` из `@/src/app/utils/client`
- Заменен вызов клиентской функции на запрос к серверному API `/api/glucose/calculate`

### 3. Удалена клиентская функция getGlucose
**Файл:** `/src/app/utils/client.ts`

- Удалена функция `getGlucose` (строки 14-84)
- Удален неиспользуемый импорт `moment`
- Удален неиспользуемый импорт `GlucoseHistory`

### 4. Обновлен существующий API endpoint
**Файл:** `/src/app/api/libre/route.ts`

- Заменены хардкод учетные данные на переменные окружения:
  - `process.env.LIBRE_EMAIL`
  - `process.env.LIBRE_PASSWORD`

### 5. Обновлена документация
**Файл:** `/README.md`

Добавлена секция с описанием необходимых переменных окружения.

## Необходимые переменные окружения

Добавьте в файл `.env.development.local`:

```env
DATABASE_URL=your_neon_database_url
LIBRE_EMAIL=your_libreview_email@example.com
LIBRE_PASSWORD=your_libreview_password
```

## Преимущества миграции

1. **Безопасность:** Учетные данные LibreView теперь хранятся на сервере
2. **Производительность:** Расчеты выполняются на сервере, снижая нагрузку на клиент
3. **Консистентность:** Единая точка обновления данных в БД
4. **Масштабируемость:** Логика расчетов централизована и легче поддерживается

## Обратная совместимость

Изменения полностью обратно совместимы. API возвращает те же типы данных (`Glucose`), что и клиентская функция.
