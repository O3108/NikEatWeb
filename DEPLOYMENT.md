# Инструкция по деплою на продакшен

## Проблема на проде
Глюкоза не обновляется из-за:
1. Отсутствия переменных окружения
2. Разницы в часовых поясах между локальной машиной и Vercel

## Решение

### 1. Добавить переменные окружения на Vercel

Перейдите на https://vercel.com и выполните:

1. Откройте ваш проект
2. Settings → Environment Variables
3. Добавьте переменные:

```
LIBRE_EMAIL = o3108@yandex.ru
LIBRE_PASSWORD = Olegchurilov92
DATABASE_URL = your_neon_database_url
```

4. Выберите все окружения: Production, Preview, Development
5. Сохраните

### 2. Задеплоить изменения

Выполните в терминале:

```bash
# Убедитесь, что все изменения закоммичены
git status

# Отправьте изменения в репозиторий
git push origin main
```

Vercel автоматически задеплоит изменения.

### 3. Проверка

После деплоя:

1. Откройте Vercel Dashboard → Deployments → последний деплой
2. Перейдите в Functions → Runtime Logs
3. Проверьте логи API `/api/glucose/calculate`:
   - Должны быть логи: "Current time (Yekaterinburg): ..."
   - Должны быть логи: "Updating night/day glucose data..."
   - Не должно быть ошибок о missing credentials

4. Откройте ваше приложение и проверьте обновление данных глюкозы

## Что исправлено

### Коммит 1: `cc32f14`
- Перенос функции getGlucose на сервер
- Использование переменных окружения вместо хардкода
- Улучшенная обработка ошибок

### Коммит 2: `f34e1d9`
- Использование moment-timezone для корректной работы с часовыми поясами
- Добавлено логирование для отладки
- Исправлена проблема с обновлением на проде

## Отладка

Если данные все еще не обновляются:

1. Проверьте логи в Vercel:
   ```
   Dashboard → Project → Functions → Runtime Logs
   ```

2. Проверьте текущее время сервера в логах:
   ```
   Current time (Yekaterinburg): DD.MM.YY HH:mm
   ```

3. Проверьте, что условия обновления выполняются:
   - Для ночных данных: час >= 10 и дата ночи < текущей даты
   - Для дневных данных: час >= 22 и дата дня < текущей даты

4. Проверьте, что переменные окружения установлены:
   ```
   Settings → Environment Variables
   ```
